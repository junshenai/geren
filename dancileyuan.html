<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«ä¹è‹±è¯­å•è¯ä¹å›­</title>
    <style>
        :root {
            --primary-color: #FF6B6B;
            --secondary-color: #4ECDC4;
            --accent-color: #FFE66D;
            --dark-color: #292F36;
            --light-color: #F7FFF7;
        }
        
        body {
            font-family: 'Comic Sans MS', 'Marker Felt', 'å¾®è½¯é›…é»‘', sans-serif;
            background-color: #F0F8FF;
            margin: 0;
            padding: 0;
            color: var(--dark-color);
            background-image: url('https://img.freepik.com/free-vector/hand-drawn-school-background_23-2149464866.jpg?w=1380&t=st=1698765432~exp=1698766032~hmac=...');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: bounce 2s infinite;
        }
        
        h2 {
            color: var(--secondary-color);
            border-bottom: 3px dotted var(--accent-color);
            padding-bottom: 5px;
            margin-top: 30px;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: var(--light-color);
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tab.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .tab:hover {
            background-color: var(--accent-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid var(--secondary-color);
            font-family: inherit;
            margin-bottom: 10px;
            resize: vertical;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            background-color: #FF8E8E;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .word-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .word-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            width: calc(33% - 20px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .word-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .word-card h3 {
            color: var(--primary-color);
            margin-top: 0;
        }
        
        .word-card p {
            color: var(--dark-color);
            margin-bottom: 0;
        }
        
        .quiz-container {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .quiz-question {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--dark-color);
            text-align: center;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .quiz-option {
            background-color: var(--light-color);
            border: 2px solid var(--secondary-color);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .quiz-option:hover {
            background-color: var(--accent-color);
            transform: scale(1.02);
        }
        
        .quiz-option.correct {
            background-color: #A8E6CF;
            border-color: #4CAF50;
            animation: pulse 0.5s;
        }
        
        .quiz-option.incorrect {
            background-color: #FFAAA5;
            border-color: #FF5252;
        }
        
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 20px 0;
            height: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.3s;
            border-radius: 10px;
        }
        
        .feedback {
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            min-height: 30px;
        }
        
        .positive-feedback {
            color: #4CAF50;
            font-weight: bold;
            animation: celebrate 1s;
        }
        
        .encouragement {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--accent-color);
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 100;
        }
        
        .jigsaw-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .jigsaw-piece {
            background-color: white;
            border: 2px dashed var(--secondary-color);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .jigsaw-piece:hover {
            background-color: var(--accent-color);
        }
        
        .jigsaw-piece.matched {
            background-color: #A8E6CF;
            border-style: solid;
            border-color: #4CAF50;
        }
        
        .difficulty-selector {
            margin: 20px 0;
            text-align: center;
        }
        
        .difficulty-btn {
            background-color: var(--light-color);
            color: var(--dark-color);
        }
        
        .difficulty-btn.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }
        
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        
        @keyframes pulse {
            0% {transform: scale(1);}
            50% {transform: scale(1.05);}
            100% {transform: scale(1);}
        }
        
        @keyframes celebrate {
            0% {transform: scale(1);}
            25% {transform: scale(1.2) rotate(5deg);}
            50% {transform: scale(1.1) rotate(-5deg);}
            75% {transform: scale(1.2) rotate(5deg);}
            100% {transform: scale(1) rotate(0deg);}
        }
        
        @keyframes confetti {
            0% {transform: translateY(0) rotate(0deg); opacity: 1;}
            100% {transform: translateY(100vh) rotate(360deg); opacity: 0;}
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--primary-color);
            opacity: 0;
            z-index: 99;
            animation: confetti 3s ease-out;
        }
        
        .star {
            color: gold;
            font-size: 1.5rem;
            margin: 0 2px;
            animation: pulse 1s infinite alternate;
        }
        
        .difficulty-stars {
            display: inline-block;
            margin-left: 10px;
        }
        
        .word-difficulty {
            font-size: 0.8rem;
            color: #777;
            margin-top: 5px;
        }
        
        .difficulty-1 { color: #4CAF50; }
        .difficulty-2 { color: #FFC107; }
        .difficulty-3 { color: #FF9800; }
        .difficulty-4 { color: #FF5722; }
        .difficulty-5 { color: #F44336; }
        
        @media (max-width: 768px) {
            .word-card {
                width: calc(50% - 15px);
            }
            
            .quiz-options {
                grid-template-columns: 1fr;
            }
            
            .jigsaw-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .word-card {
                width: 100%;
            }
            
            .jigsaw-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ å¿«ä¹è‹±è¯­å•è¯ä¹å›­ ğŸŒŸ</h1>
        
        <div class="tab-container">
            <div class="tab active" onclick="openTab('import-tab')">å¯¼å…¥å•è¯</div>
            <div class="tab" onclick="openTab('learn-tab')">å­¦ä¹ å•è¯</div>
            <div class="tab" onclick="openTab('quiz-tab')">å•è¯æµ‹è¯•</div>
            <div class="tab" onclick="openTab('jigsaw-tab')">æ‹¼å›¾æ¸¸æˆ</div>
        </div>
        
        <!-- å¯¼å…¥å•è¯æ ‡ç­¾é¡µ -->
        <div id="import-tab" class="tab-content active">
            <h2>å¯¼å…¥ä½ çš„å•è¯</h2>
            <p>è¯·è¾“å…¥è‹±æ–‡å•è¯å’Œå¯¹åº”çš„ä¸­æ–‡æ„æ€ï¼Œæ¯è¡Œä¸€ä¸ªå•è¯ï¼Œæ ¼å¼ä¸ºï¼šè‹±æ–‡=ä¸­æ–‡</p>
            <textarea id="word-input" placeholder="ä¾‹å¦‚ï¼š
apple=è‹¹æœ
banana=é¦™è•‰
cat=çŒ«"></textarea>
            <button onclick="importWords()">å¯¼å…¥å•è¯</button>
            <button onclick="clearWords()">æ¸…ç©ºå•è¯</button>
            <button onclick="loadSampleWords()">åŠ è½½ç¤ºä¾‹å•è¯</button>
            
            <h2>ä½ çš„å•è¯åº“</h2>
            <div id="word-list" class="word-list"></div>
        </div>
        
        <!-- å­¦ä¹ å•è¯æ ‡ç­¾é¡µ -->
        <div id="learn-tab" class="tab-content">
            <h2>å­¦ä¹ å•è¯</h2>
            <div id="learn-container">
                <p>è¯·å…ˆå¯¼å…¥ä¸€äº›å•è¯å¼€å§‹å­¦ä¹ ï¼</p>
            </div>
            <button id="next-word-btn" style="display: none;" onclick="showNextWord()">ä¸‹ä¸€ä¸ªå•è¯</button>
        </div>
        
        <!-- å•è¯æµ‹è¯•æ ‡ç­¾é¡µ -->
        <div id="quiz-tab" class="tab-content">
            <h2>å•è¯å°æµ‹è¯•</h2>
            <div class="difficulty-selector">
                <p>é€‰æ‹©æµ‹è¯•éš¾åº¦ï¼š</p>
                <button class="difficulty-btn active" onclick="setQuizDifficulty('easy')">ç®€å•</button>
                <button class="difficulty-btn" onclick="setQuizDifficulty('medium')">ä¸­ç­‰</button>
                <button class="difficulty-btn" onclick="setQuizDifficulty('hard')">å›°éš¾</button>
            </div>
            <div id="quiz-container" class="quiz-container" style="display: none;">
                <div class="progress-container">
                    <div id="quiz-progress" class="progress-bar"></div>
                </div>
                <div id="quiz-question" class="quiz-question"></div>
                <div id="quiz-options" class="quiz-options"></div>
                <div id="quiz-feedback" class="feedback"></div>
                <button id="next-question-btn" style="display: none;" onclick="nextQuizQuestion()">ç»§ç»­</button>
            </div>
            <button id="start-quiz-btn" onclick="startQuiz()">å¼€å§‹æµ‹è¯•</button>
        </div>
        
        <!-- æ‹¼å›¾æ¸¸æˆæ ‡ç­¾é¡µ -->
        <div id="jigsaw-tab" class="tab-content">
            <h2>å•è¯æ‹¼å›¾</h2>
            <p>å°†è‹±æ–‡å•è¯å’Œå¯¹åº”çš„ä¸­æ–‡æ„æ€é…å¯¹èµ·æ¥ï¼</p>
            <div class="difficulty-selector">
                <p>é€‰æ‹©æ‹¼å›¾æ•°é‡ï¼š</p>
                <button class="difficulty-btn active" onclick="setJigsawDifficulty(6)">6ä¸ª</button>
                <button class="difficulty-btn" onclick="setJigsawDifficulty(9)">9ä¸ª</button>
                <button class="difficulty-btn" onclick="setJigsawDifficulty(12)">12ä¸ª</button>
            </div>
            <div id="jigsaw-container" class="jigsaw-container"></div>
            <button id="start-jigsaw-btn" onclick="startJigsaw()">å¼€å§‹æ‹¼å›¾</button>
            <div id="jigsaw-feedback" class="feedback"></div>
        </div>
    </div>
    
    <div id="encouragement" class="encouragement">å¤ªæ£’äº†ï¼ç»§ç»­åŠ æ²¹ï¼</div>
    
    <script>
        // å•è¯åº“
        let words = [];
        // å­¦ä¹ æ¨¡å¼ä¸­çš„å•è¯ç´¢å¼•
        let currentWordIndex = 0;
        // æµ‹è¯•æ¨¡å¼ä¸­çš„é—®é¢˜
        let quizQuestions = [];
        let currentQuizQuestion = 0;
        let quizScore = 0;
        let quizDifficulty = 'easy';
        // æ‹¼å›¾æ¸¸æˆ
        let jigsawPieces = [];
        let selectedPiece = null;
        let matchedPairs = 0;
        let jigsawDifficulty = 6;
        // å•è¯éš¾åº¦è®°å½•
        let wordDifficulties = {};
        
        // æ‰“å¼€æ ‡ç­¾é¡µ
        function openTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // å–æ¶ˆæ‰€æœ‰æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabId).classList.add('active');
            
            // è®¾ç½®é€‰ä¸­çš„æ ‡ç­¾ä¸ºæ´»åŠ¨çŠ¶æ€
            event.currentTarget.classList.add('active');
            
            // å¦‚æœåˆ‡æ¢åˆ°å­¦ä¹ æ ‡ç­¾ï¼Œåˆå§‹åŒ–å­¦ä¹ æ¨¡å¼
            if (tabId === 'learn-tab' && words.length > 0) {
                showWordToLearn();
            }
        }
        
        // å¯¼å…¥å•è¯
        function importWords() {
            const input = document.getElementById('word-input').value.trim();
            if (!input) {
                showEncouragement('è¯·è¾“å…¥ä¸€äº›å•è¯ï¼', false);
                return;
            }
            
            const lines = input.split('\n');
            const newWords = [];
            
            lines.forEach(line => {
                line = line.trim();
                if (line.includes('=')) {
                    const parts = line.split('=');
                    if (parts.length >= 2) {
                        const english = parts[0].trim();
                        const chinese = parts[1].trim();
                        if (english && chinese) {
                            newWords.push({ english, chinese });
                            
                            // åˆå§‹åŒ–å•è¯éš¾åº¦
                            const key = `${english}-${chinese}`;
                            if (!wordDifficulties[key]) {
                                wordDifficulties[key] = 1; // é»˜è®¤éš¾åº¦ä¸º1
                            }
                        }
                    }
                }
            });
            
            if (newWords.length > 0) {
                words = [...words, ...newWords];
                updateWordList();
                showEncouragement(`æˆåŠŸå¯¼å…¥ ${newWords.length} ä¸ªå•è¯ï¼`, true);
                
                // å¦‚æœå½“å‰åœ¨å­¦ä¹ æ ‡ç­¾é¡µï¼Œæ˜¾ç¤ºç¬¬ä¸€ä¸ªå•è¯
                if (document.getElementById('learn-tab').classList.contains('active')) {
                    showWordToLearn();
                }
            } else {
                showEncouragement('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„å•è¯æ ¼å¼ï¼', false);
            }
        }
        
        // æ¸…ç©ºå•è¯
        function clearWords() {
            words = [];
            wordDifficulties = {};
            updateWordList();
            document.getElementById('word-input').value = '';
            showEncouragement('å•è¯åº“å·²æ¸…ç©ºï¼', false);
        }
        
        // åŠ è½½ç¤ºä¾‹å•è¯
        function loadSampleWords() {
            const sampleWords = `apple=è‹¹æœ
banana=é¦™è•‰
cat=çŒ«
dog=ç‹—
elephant=å¤§è±¡
fish=é±¼
giraffe=é•¿é¢ˆé¹¿
house=æˆ¿å­
ice cream=å†°æ·‡æ·‹
juice=æœæ±
kite=é£ç­
lion=ç‹®å­
monkey=çŒ´å­
nose=é¼»å­
orange=æ©™å­
panda=ç†ŠçŒ«
queen=å¥³ç‹
rabbit=å…”å­
sun=å¤ªé˜³
tiger=è€è™
umbrella=é›¨ä¼
vegetable=è”¬èœ
watermelon=è¥¿ç“œ
xylophone=æœ¨ç´
yellow=é»„è‰²
zebra=æ–‘é©¬`;
            
            document.getElementById('word-input').value = sampleWords;
            showEncouragement('ç¤ºä¾‹å•è¯å·²åŠ è½½ï¼Œç‚¹å‡»"å¯¼å…¥å•è¯"æŒ‰é’®å¯¼å…¥ï¼', true);
        }
        
        // æ›´æ–°å•è¯åˆ—è¡¨æ˜¾ç¤º
        function updateWordList() {
            const wordListElement = document.getElementById('word-list');
            wordListElement.innerHTML = '';
            
            if (words.length === 0) {
                wordListElement.innerHTML = '<p>è¿˜æ²¡æœ‰å•è¯ï¼Œè¯·å…ˆå¯¼å…¥ä¸€äº›å•è¯å§ï¼</p>';
                return;
            }
            
            words.forEach((word, index) => {
                const key = `${word.english}-${word.chinese}`;
                const difficulty = wordDifficulties[key] || 1;
                
                const card = document.createElement('div');
                card.className = 'word-card';
                card.innerHTML = `
                    <h3>${word.english}</h3>
                    <p>${word.chinese}</p>
                    <div class="word-difficulty">
                        éš¾åº¦: <span class="difficulty-${difficulty}">${getDifficultyStars(difficulty)}</span>
                    </div>
                    <button onclick="removeWord(${index})" style="padding: 5px 10px; font-size: 0.8rem; margin-top: 10px;">åˆ é™¤</button>
                `;
                wordListElement.appendChild(card);
            });
        }
        
        // è·å–éš¾åº¦æ˜Ÿçº§æ˜¾ç¤º
        function getDifficultyStars(difficulty) {
            let stars = '';
            for (let i = 0; i < 5; i++) {
                if (i < difficulty) {
                    stars += '<span class="star">â˜…</span>';
                } else {
                    stars += '<span class="star">â˜†</span>';
                }
            }
            return stars;
        }
        
        // åˆ é™¤å•è¯
        function removeWord(index) {
            const removedWord = words[index];
            const key = `${removedWord.english}-${removedWord.chinese}`;
            delete wordDifficulties[key];
            
            words.splice(index, 1);
            updateWordList();
            showEncouragement('å•è¯å·²åˆ é™¤ï¼', false);
        }
        
        // æ˜¾ç¤ºé¼“åŠ±è¯­å¥
        function showEncouragement(message, isPositive) {
            const encouragement = document.getElementById('encouragement');
            encouragement.textContent = message;
            encouragement.style.opacity = '1';
            
            if (isPositive) {
                encouragement.style.backgroundColor = '#A8E6CF';
                createConfetti();
            } else {
                encouragement.style.backgroundColor = '#FFD3B6';
            }
            
            setTimeout(() => {
                encouragement.style.opacity = '0';
            }, 2000);
        }
        
        // åˆ›å»ºåº†ç¥å½©èŠ±
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = getRandomColor();
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }
        
        // è·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#A8E6CF', '#DCE2C8', '#F7C1BB'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // å­¦ä¹ æ¨¡å¼ - æ˜¾ç¤ºå•è¯
        function showWordToLearn() {
            if (words.length === 0) {
                document.getElementById('learn-container').innerHTML = '<p>è¯·å…ˆå¯¼å…¥ä¸€äº›å•è¯å¼€å§‹å­¦ä¹ ï¼</p>';
                document.getElementById('next-word-btn').style.display = 'none';
                return;
            }
            
            // æ ¹æ®å•è¯éš¾åº¦æ’åºï¼Œä¼˜å…ˆæ˜¾ç¤ºéš¾åº¦é«˜çš„å•è¯
            const sortedWords = [...words].sort((a, b) => {
                const keyA = `${a.english}-${a.chinese}`;
                const keyB = `${b.english}-${b.chinese}`;
                return (wordDifficulties[keyB] || 1) - (wordDifficulties[keyA] || 1);
            });
            
            // å¾ªç¯æ˜¾ç¤ºå•è¯
            if (currentWordIndex >= sortedWords.length) {
                currentWordIndex = 0;
            }
            
            const word = sortedWords[currentWordIndex];
            const key = `${word.english}-${word.chinese}`;
            const difficulty = wordDifficulties[key] || 1;
            
            // éšæœºå†³å®šæ˜¾ç¤ºè‹±æ–‡è¿˜æ˜¯ä¸­æ–‡
            const showEnglishFirst = Math.random() > 0.5;
            
            document.getElementById('learn-container').innerHTML = `
                <div style="text-align: center;">
                    <h2 style="font-size: 2.5rem; color: ${showEnglishFirst ? '#FF6B6B' : '#4ECDC4'}; margin-bottom: 10px;">
                        ${showEnglishFirst ? word.english : word.chinese}
                    </h2>
                    <div style="margin: 20px 0;">
                        <button onclick="revealTranslation()" style="font-size: 1.2rem;">æ˜¾ç¤º${showEnglishFirst ? 'ä¸­æ–‡' : 'è‹±æ–‡'}</button>
                    </div>
                    <div id="translation" style="display: none;">
                        <h2 style="font-size: 2.5rem; color: ${showEnglishFirst ? '#4ECDC4' : '#FF6B6B'};">
                            ${showEnglishFirst ? word.chinese : word.english}
                        </h2>
                        <div style="margin-top: 20px;">
                            <p>è¿™ä¸ªå•è¯å¯¹ä½ æ¥è¯´ï¼š</p>
                            <button onclick="rateDifficulty('${key}', 1)" style="background-color: #A8E6CF;">å¾ˆç®€å•</button>
                            <button onclick="rateDifficulty('${key}', 3)" style="background-color: #FFD3B6;">æœ‰ç‚¹éš¾</button>
                            <button onclick="rateDifficulty('${key}', 5)" style="background-color: #FFAAA5;">éå¸¸éš¾</button>
                        </div>
                    </div>
                    <div class="difficulty-stars">
                        ${getDifficultyStars(difficulty)}
                    </div>
                </div>
            `;
            
            document.getElementById('next-word-btn').style.display = 'none';
        }
        
        // æ˜¾ç¤ºç¿»è¯‘
        function revealTranslation() {
            document.getElementById('translation').style.display = 'block';
            document.getElementById('next-word-btn').style.display = 'inline-block';
        }
        
        // è¯„ä»·å•è¯éš¾åº¦
        function rateDifficulty(key, rating) {
            wordDifficulties[key] = rating;
            updateWordList();
            showNextWord();
        }
        
        // æ˜¾ç¤ºä¸‹ä¸€ä¸ªå•è¯
        function showNextWord() {
            currentWordIndex++;
            showWordToLearn();
        }
        
        // è®¾ç½®æµ‹è¯•éš¾åº¦
        function setQuizDifficulty(difficulty) {
            quizDifficulty = difficulty;
            
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
        }
        
        // å¼€å§‹æµ‹è¯•
        function startQuiz() {
            if (words.length < 4) {
                showEncouragement('è‡³å°‘éœ€è¦4ä¸ªå•è¯æ‰èƒ½å¼€å§‹æµ‹è¯•ï¼', false);
                return;
            }
            
            // æ ¹æ®éš¾åº¦é€‰æ‹©æµ‹è¯•å•è¯
            let quizWords = [];
            if (quizDifficulty === 'easy') {
                // é€‰æ‹©éš¾åº¦1-2çš„å•è¯
                quizWords = words.filter(word => {
                    const key = `${word.english}-${word.chinese}`;
                    return (wordDifficulties[key] || 1) <= 2;
                });
                
                if (quizWords.length < 4) {
                    quizWords = [...words]; // å¦‚æœæ²¡æœ‰è¶³å¤Ÿç®€å•å•è¯ï¼Œä½¿ç”¨æ‰€æœ‰å•è¯
                }
            } else if (quizDifficulty === 'medium') {
                // é€‰æ‹©éš¾åº¦2-4çš„å•è¯
                quizWords = words.filter(word => {
                    const key = `${word.english}-${word.chinese}`;
                    const difficulty = wordDifficulties[key] || 1;
                    return difficulty >= 2 && difficulty <= 4;
                });
                
                if (quizWords.length < 4) {
                    quizWords = [...words]; // å¦‚æœæ²¡æœ‰è¶³å¤Ÿä¸­ç­‰å•è¯ï¼Œä½¿ç”¨æ‰€æœ‰å•è¯
                }
            } else {
                // å›°éš¾æ¨¡å¼ - é€‰æ‹©éš¾åº¦3-5çš„å•è¯
                quizWords = words.filter(word => {
                    const key = `${word.english}-${word.chinese}`;
                    return (wordDifficulties[key] || 1) >= 3;
                });
                
                if (quizWords.length < 4) {
                    quizWords = [...words]; // å¦‚æœæ²¡æœ‰è¶³å¤Ÿå›°éš¾å•è¯ï¼Œä½¿ç”¨æ‰€æœ‰å•è¯
                }
            }
            
            // éšæœºé€‰æ‹©10ä¸ªå•è¯æˆ–æ‰€æœ‰å•è¯ï¼ˆå¦‚æœå°‘äº10ä¸ªï¼‰
            const testSize = Math.min(10, quizWords.length);
            quizQuestions = [];
            
            // éšæœºé€‰æ‹©å•è¯
            const selectedWords = [...quizWords];
            shuffleArray(selectedWords);
            selectedWords.slice(0, testSize).forEach(word => {
                // éšæœºå†³å®šæ˜¯è‹±è¯‘ä¸­è¿˜æ˜¯ä¸­è¯‘è‹±
                const isEnglishToChinese = Math.random() > 0.5;
                
                quizQuestions.push({
                    type: isEnglishToChinese ? 'en-cn' : 'cn-en',
                    question: isEnglishToChinese ? word.english : word.chinese,
                    answer: isEnglishToChinese ? word.chinese : word.english,
                    wordKey: `${word.english}-${word.chinese}`
                });
            });
            
            currentQuizQuestion = 0;
            quizScore = 0;
            showQuizQuestion();
            
            document.getElementById('start-quiz-btn').style.display = 'none';
            document.getElementById('quiz-container').style.display = 'block';
        }
        
        // æ˜¾ç¤ºæµ‹è¯•é—®é¢˜
        function showQuizQuestion() {
            if (currentQuizQuestion >= quizQuestions.length) {
                // æµ‹è¯•ç»“æŸ
                const percentage = Math.round((quizScore / quizQuestions.length) * 100);
                let message = `æµ‹è¯•å®Œæˆï¼ä½ çš„å¾—åˆ†: ${quizScore}/${quizQuestions.length} (${percentage}%) `;
                
                if (percentage >= 80) {
                    message += 'ğŸŒŸ å¤ªæ£’äº†ï¼ä½ æ˜¯å•è¯å°è¾¾äººï¼';
                    showEncouragement('å¤ªå‰å®³äº†ï¼', true);
                } else if (percentage >= 50) {
                    message += 'ğŸ‘ ä¸é”™ï¼Œç»§ç»­åŠ æ²¹ï¼';
                    showEncouragement('åšå¾—ä¸é”™ï¼', true);
                } else {
                    message += 'ğŸ’ª å†åŠ æŠŠåŠ²ï¼Œå¤šç»ƒä¹ å‡ æ¬¡ï¼';
                    showEncouragement('ä¸è¦ç°å¿ƒï¼', false);
                }
                
                document.getElementById('quiz-container').innerHTML = `
                    <h2 style="text-align: center;">æµ‹è¯•ç»“æœ</h2>
                    <div style="text-align: center; font-size: 1.5rem; margin: 20px 0;">
                        ${message}
                    </div>
                    <div style="text-align: center;">
                        <button onclick="startQuiz()">å†è¯•ä¸€æ¬¡</button>
                        <button onclick="location.reload()">è¿”å›é¦–é¡µ</button>
                    </div>
                `;
                return;
            }
            
            const question = quizQuestions[currentQuizQuestion];
            document.getElementById('quiz-question').textContent = question.question;
            
            // æ›´æ–°è¿›åº¦æ¡
            document.getElementById('quiz-progress').style.width = 
                `${(currentQuizQuestion / quizQuestions.length) * 100}%`;
            
            // ç”Ÿæˆé€‰é¡¹
            const options = [question.answer];
            
            // æ·»åŠ 3ä¸ªé”™è¯¯é€‰é¡¹
            while (options.length < 4) {
                let randomWord;
                if (question.type === 'en-cn') {
                    // è‹±è¯‘ä¸­ï¼Œæ‰¾å…¶ä»–ä¸­æ–‡æ„æ€
                    randomWord = words[Math.floor(Math.random() * words.length)];
                    if (!options.includes(randomWord.chinese)) {
                        options.push(randomWord.chinese);
                    }
                } else {
                    // ä¸­è¯‘è‹±ï¼Œæ‰¾å…¶ä»–è‹±æ–‡å•è¯
                    randomWord = words[Math.floor(Math.random() * words.length)];
                    if (!options.includes(randomWord.english)) {
                        options.push(randomWord.english);
                    }
                }
            }
            
            // æ‰“ä¹±é€‰é¡¹é¡ºåº
            shuffleArray(options);
            
            // æ˜¾ç¤ºé€‰é¡¹
            const optionsElement = document.getElementById('quiz-options');
            optionsElement.innerHTML = '';
            
            options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.onclick = () => checkQuizAnswer(option, question.answer, question.wordKey);
                optionsElement.appendChild(optionElement);
            });
            
            document.getElementById('quiz-feedback').textContent = '';
            document.getElementById('next-question-btn').style.display = 'none';
        }
        
        // æ£€æŸ¥æµ‹è¯•ç­”æ¡ˆ
        function checkQuizAnswer(selectedAnswer, correctAnswer, wordKey) {
            const options = document.querySelectorAll('.quiz-option');
            let isCorrect = false;
            
            options.forEach(option => {
                if (option.textContent === correctAnswer) {
                    option.classList.add('correct');
                    if (option.textContent === selectedAnswer) {
                        isCorrect = true;
                        quizScore++;
                        
                        // å¦‚æœç­”å¯¹äº†ï¼Œé™ä½å•è¯éš¾åº¦
                        if (wordDifficulties[wordKey] > 1) {
                            wordDifficulties[wordKey]--;
                        }
                    }
                } else if (option.textContent === selectedAnswer && selectedAnswer !== correctAnswer) {
                    option.classList.add('incorrect');
                    
                    // å¦‚æœç­”é”™äº†ï¼Œå¢åŠ å•è¯éš¾åº¦
                    if (wordDifficulties[wordKey] < 5) {
                        wordDifficulties[wordKey]++;
                    }
                }
                
                option.style.pointerEvents = 'none'; // ç¦ç”¨ç‚¹å‡»
            });
            
            // æ›´æ–°å•è¯åˆ—è¡¨æ˜¾ç¤º
            updateWordList();
            
            // æ˜¾ç¤ºåé¦ˆ
            const feedbackElement = document.getElementById('quiz-feedback');
            if (isCorrect) {
                feedbackElement.textContent = 'âœ… ç­”å¯¹äº†ï¼å¤ªæ£’äº†ï¼';
                feedbackElement.className = 'feedback positive-feedback';
                showEncouragement(getRandomEncouragement(), true);
            } else {
                feedbackElement.textContent = `âŒ ç­”é”™äº†ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯: ${correctAnswer}`;
                feedbackElement.className = 'feedback';
                showEncouragement(getRandomMotivation(), false);
            }
            
            document.getElementById('next-question-btn').style.display = 'inline-block';
        }
        
        // è·å–éšæœºé¼“åŠ±è¯­å¥
        function getRandomEncouragement() {
            const encouragements = [
                'å¤ªæ£’äº†ï¼',
                'ä½ çœŸèªæ˜ï¼',
                'åšå¾—å¥½ï¼',
                'ç»§ç»­åŠ æ²¹ï¼',
                'ä½ æ˜¯å•è¯å°è¾¾äººï¼',
                'å®Œç¾ï¼',
                'å‰å®³ï¼',
                'å“‡å¡ï¼',
                'æƒŠäººçš„è®°å¿†åŠ›ï¼',
                'ä¿æŒè¿™ä¸ªçŠ¶æ€ï¼'
            ];
            return encouragements[Math.floor(Math.random() * encouragements.length)];
        }
        
        // è·å–éšæœºæ¿€åŠ±è¯­å¥
        function getRandomMotivation() {
            const motivations = [
                'ä¸è¦ç°å¿ƒï¼',
                'å†è¯•ä¸€æ¬¡ï¼',
                'ä¸‹æ¬¡ä¼šæ›´å¥½ï¼',
                'é”™è¯¯æ˜¯å­¦ä¹ çš„æœºä¼šï¼',
                'åŠ æ²¹ï¼',
                'ä½ å¯ä»¥çš„ï¼',
                'åšæŒå°±æ˜¯èƒœåˆ©ï¼',
                'å¤šç»ƒä¹ å‡ æ¬¡ï¼',
                'ç†Ÿèƒ½ç”Ÿå·§ï¼',
                'æ…¢æ…¢æ¥ï¼Œåˆ«ç€æ€¥ï¼'
            ];
            return motivations[Math.floor(Math.random() * motivations.length)];
        }
        
        // ä¸‹ä¸€ä¸ªæµ‹è¯•é—®é¢˜
        function nextQuizQuestion() {
            currentQuizQuestion++;
            showQuizQuestion();
        }
        
        // è®¾ç½®æ‹¼å›¾éš¾åº¦
        function setJigsawDifficulty(difficulty) {
            jigsawDifficulty = difficulty;
            
            document.querySelectorAll('#jigsaw-tab .difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
        }
        
        // å¼€å§‹æ‹¼å›¾æ¸¸æˆ
        function startJigsaw() {
            if (words.length < jigsawDifficulty / 2) {
                showEncouragement(`è‡³å°‘éœ€è¦ ${Math.ceil(jigsawDifficulty / 2)} ä¸ªå•è¯æ‰èƒ½å¼€å§‹æ‹¼å›¾ï¼`, false);
                return;
            }
            
            // æ ¹æ®éš¾åº¦é€‰æ‹©å•è¯
            let jigsawWords = [];
            if (jigsawDifficulty === 6) {
                // ç®€å•æ¨¡å¼ - é€‰æ‹©éš¾åº¦1-2çš„å•è¯
                jigsawWords = words.filter(word => {
                    const key = `${word.english}-${word.chinese}`;
                    return (wordDifficulties[key] || 1) <= 2;
                });
                
                if (jigsawWords.length < 3) {
                    jigsawWords = [...words]; // å¦‚æœæ²¡æœ‰è¶³å¤Ÿç®€å•å•è¯ï¼Œä½¿ç”¨æ‰€æœ‰å•è¯
                }
            } else if (jigsawDifficulty === 9) {
                // ä¸­ç­‰æ¨¡å¼ - é€‰æ‹©éš¾åº¦2-4çš„å•è¯
                jigsawWords = words.filter(word => {
                    const key = `${word.english}-${word.chinese}`;
                    const difficulty = wordDifficulties[key] || 1;
                    return difficulty >= 2 && difficulty <= 4;
                });
                
                if (jigsawWords.length < 5) {
                    jigsawWords = [...words]; // å¦‚æœæ²¡æœ‰è¶³å¤Ÿä¸­ç­‰å•è¯ï¼Œä½¿ç”¨æ‰€æœ‰å•è¯
                }
            } else {
                // å›°éš¾æ¨¡å¼ - é€‰æ‹©éš¾åº¦3-5çš„å•è¯
                jigsawWords = words.filter(word => {
                    const key = `${word.english}-${word.chinese}`;
                    return (wordDifficulties[key] || 1) >= 3;
                });
                
                if (jigsawWords.length < 6) {
                    jigsawWords = [...words]; // å¦‚æœæ²¡æœ‰è¶³å¤Ÿå›°éš¾å•è¯ï¼Œä½¿ç”¨æ‰€æœ‰å•è¯
                }
            }
            
            // éšæœºé€‰æ‹©å•è¯
            const selectedWords = [...jigsawWords];
            shuffleArray(selectedWords);
            selectedWords.splice(jigsawDifficulty / 2); // åªä¿ç•™éœ€è¦çš„æ•°é‡
            
            // åˆ›å»ºæ‹¼å›¾å—
            jigsawPieces = [];
            selectedWords.forEach(word => {
                jigsawPieces.push({
                    type: 'english',
                    content: word.english,
                    pair: word.chinese,
                    matched: false
                });
                
                jigsawPieces.push({
                    type: 'chinese',
                    content: word.chinese,
                    pair: word.english,
                    matched: false
                });
            });
            
            // æ‰“ä¹±æ‹¼å›¾å—é¡ºåº
            shuffleArray(jigsawPieces);
            
            // æ˜¾ç¤ºæ‹¼å›¾å—
            renderJigsawPieces();
            
            selectedPiece = null;
            matchedPairs = 0;
            document.getElementById('jigsaw-feedback').textContent = '';
            document.getElementById('start-jigsaw-btn').style.display = 'none';
        }
        
        // æ¸²æŸ“æ‹¼å›¾å—
        function renderJigsawPieces() {
            const container = document.getElementById('jigsaw-container');
            container.innerHTML = '';
            
            // è®¾ç½®ç½‘æ ¼åˆ—æ•°
            if (jigsawDifficulty === 6) {
                container.style.gridTemplateColumns = 'repeat(3, 1fr)';
            } else if (jigsawDifficulty === 9) {
                container.style.gridTemplateColumns = 'repeat(3, 1fr)';
            } else {
                container.style.gridTemplateColumns = 'repeat(4, 1fr)';
            }
            
            jigsawPieces.forEach((piece, index) => {
                const pieceElement = document.createElement('div');
                pieceElement.className = 'jigsaw-piece';
                if (piece.matched) {
                    pieceElement.classList.add('matched');
                }
                pieceElement.textContent = piece.content;
                pieceElement.onclick = () => selectJigsawPiece(index);
                container.appendChild(pieceElement);
            });
        }
        
        // é€‰æ‹©æ‹¼å›¾å—
        function selectJigsawPiece(index) {
            const piece = jigsawPieces[index];
            
            // å¦‚æœå·²ç»åŒ¹é…æˆ–æ˜¯åŒä¸€å—ï¼Œåˆ™å¿½ç•¥
            if (piece.matched || selectedPiece === index) {
                return;
            }
            
            // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„å—ï¼Œé€‰ä¸­å½“å‰å—
            if (selectedPiece === null) {
                selectedPiece = index;
                document.querySelectorAll('.jigsaw-piece')[index].style.backgroundColor = '#FFE66D';
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…
            const firstPiece = jigsawPieces[selectedPiece];
            
            if ((firstPiece.type === 'english' && piece.type === 'chinese' && firstPiece.pair === piece.content) ||
                (firstPiece.type === 'chinese' && piece.type === 'english' && firstPiece.pair === piece.content)) {
                // åŒ¹é…æˆåŠŸ
                jigsawPieces[selectedPiece].matched = true;
                jigsawPieces[index].matched = true;
                matchedPairs++;
                
                // æ›´æ–°å•è¯éš¾åº¦ï¼ˆé™ä½éš¾åº¦ï¼‰
                const english = firstPiece.type === 'english' ? firstPiece.content : piece.content;
                const chinese = firstPiece.type === 'chinese' ? firstPiece.content : piece.content;
                const key = `${english}-${chinese}`;
                
                if (wordDifficulties[key] > 1) {
                    wordDifficulties[key]--;
                }
                
                // æ›´æ–°å•è¯åˆ—è¡¨æ˜¾ç¤º
                updateWordList();
                
                // æ˜¾ç¤ºåé¦ˆ
                document.getElementById('jigsaw-feedback').textContent = 'âœ… åŒ¹é…æˆåŠŸï¼';
                document.getElementById('jigsaw-feedback').className = 'feedback positive-feedback';
                showEncouragement(getRandomEncouragement(), true);
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (matchedPairs === jigsawDifficulty / 2) {
                    setTimeout(() => {
                        document.getElementById('jigsaw-feedback').innerHTML = 'ğŸ‰ æ­å–œä½ å®Œæˆäº†æ‹¼å›¾æ¸¸æˆï¼';
                        document.getElementById('start-jigsaw-btn').style.display = 'inline-block';
                        document.getElementById('start-jigsaw-btn').textContent = 'å†ç©ä¸€æ¬¡';
                        createConfetti();
                    }, 500);
                }
            } else {
                // åŒ¹é…å¤±è´¥
                document.getElementById('jigsaw-feedback').textContent = 'âŒ ä¸åŒ¹é…ï¼Œå†è¯•ä¸€æ¬¡ï¼';
                document.getElementById('jigsaw-feedback').className = 'feedback';
                showEncouragement(getRandomMotivation(), false);
                
                // å¢åŠ å•è¯éš¾åº¦
                const english1 = firstPiece.type === 'english' ? firstPiece.content : '';
                const chinese1 = firstPiece.type === 'chinese' ? firstPiece.content : '';
                const english2 = piece.type === 'english' ? piece.content : '';
                const chinese2 = piece.type === 'chinese' ? piece.content : '';
                
                if (english1 && chinese2) {
                    const key = `${english1}-${chinese2}`;
                    if (wordDifficulties[key] < 5) {
                        wordDifficulties[key]++;
                    }
                } else if (chinese1 && english2) {
                    const key = `${english2}-${chinese1}`;
                    if (wordDifficulties[key] < 5) {
                        wordDifficulties[key]++;
                    }
                }
                
                // æ›´æ–°å•è¯åˆ—è¡¨æ˜¾ç¤º
                updateWordList();
                
                // çŸ­æš‚æ˜¾ç¤ºä¸åŒ¹é…æ•ˆæœ
                const pieceElements = document.querySelectorAll('.jigsaw-piece');
                pieceElements[selectedPiece].style.backgroundColor = '#FFAAA5';
                pieceElements[index].style.backgroundColor = '#FFAAA5';
                
                setTimeout(() => {
                    pieceElements[selectedPiece].style.backgroundColor = '';
                    pieceElements[index].style.backgroundColor = '';
                }, 500);
            }
            
            // é‡ç½®é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.jigsaw-piece')[selectedPiece].style.backgroundColor = '';
            selectedPiece = null;
            
            // é‡æ–°æ¸²æŸ“æ‹¼å›¾å—ï¼ˆæ›´æ–°åŒ¹é…çŠ¶æ€ï¼‰
            renderJigsawPieces();
        }
        
        // æ‰“ä¹±æ•°ç»„é¡ºåº
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            // åŠ è½½ç¤ºä¾‹å•è¯
            loadSampleWords();
        };
    </script>
</body>
</html>